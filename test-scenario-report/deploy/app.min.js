Ext.define("Rally.technicalservices.InfoLink",{extend:"Ext.Component",alias:"widget.tsinfolink",informationHtml:null,title:"Information",renderTpl:"<div id='{id}-infolinkWrap' class='tsinfolink'>..</div>",initComponent:function(){this.callParent(arguments)},onRender:function(){this.callParent(arguments),this.mon(this.el,"click",this.onClick,this)},_generateChecksum:function(a){var b,c=305419896;for(a=a.replace(/var CHECKSUM = .*;/,""),b=0;b<a.length;b++)c+=a.charCodeAt(b)*b;return c},_checkChecksum:function(){var a=this;Ext.Ajax.request({url:document.URL,params:{id:1},success:function(b){text=b.responseText,CHECKSUM&&CHECKSUM!==a._generateChecksum(text)&&(console.log("Checksums don't match!"),a.dialog&&a.dialog.add({xtype:"container",html:"Checksums do not match"}))}})},onClick:function(){var a=this;this._checkChecksum(this);var b=[];this.informationHtml&&b.push({xtype:"container",html:this.informationHtml}),b.push({xtype:"container",html:"This app was created by the Rally Technical Services Team."}),APP_BUILD_DATE&&b.push({xtype:"container",html:"Build date/time: "+APP_BUILD_DATE}),this.dialog&&this.dialog.destroy(),this.dialog=Ext.create("Rally.ui.dialog.Dialog",{defaults:{padding:5,margin:5},closable:!0,draggable:!0,title:a.title,items:b}),this.dialog.show()}}),Ext.define("Rally.technicalservices.Logger",{constructor:function(a){Ext.apply(this,a)},log:function(){var a="[ "+Ext.util.Format.date(new Date,"Y-m-d H:i:s.u")+" ]",b=[];b=Ext.Array.push(b,[a]),b=Ext.Array.push(b,Ext.Array.slice(arguments,0)),window.console&&console.log.apply(console,b)}}),Ext.override(Rally.ui.menu.DefaultRecordMenu,{_getMenuItems:function(){var a=this.getRecord(),b=[{xtype:"rallyrecordmenuitemedit",record:a,beforeAction:this.getOnBeforeRecordMenuEdit(),actionScope:this},{xtype:"rallyrecordmenuitemcopy",record:a,beforeAction:this.getOnBeforeRecordMenuCopy(),afterAction:this.getOnRecordMenuCopy(),actionScope:this}];return this.showAddTasks!==!1&&b.push({xtype:"rallyrecordmenuitemaddtask",record:a}),b.push({xtype:"rallyrecordmenuitemaddchild",record:a}),b}}),Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",columns:[],logger:new Rally.technicalservices.Logger,defaults:{padding:5,margin:5},items:[{xtype:"container",itemId:"message_box"},{xtype:"container",itemId:"grid_box"},{xtype:"tsinfolink",informationHtml:"Displays Test Cases that have either no value or duplicate values in a chosen field."}],launch:function(){this.columns=[{dataIndex:"FormattedID",text:"id",renderer:function(a,b,c){return Rally.ui.renderer.RendererFactory.renderRecordField(c,"FormattedID")}},{dataIndex:"Name",text:"Name",flex:1}],"undefined"==typeof this.getAppId()?this._showExternalSettingsDialog(this.getSettingsFields()):this._getData()},_getData:function(){this.logger.log("_getData");var a=this.getSetting("scenario_id_field_name");if("undefined"==typeof a)this.down("#message_box").update("Select 'Edit App Settings' from the gear menu to select a field to represent Scenario IDs");else{this.logger.log("Field Name: ",a),this.columns.push({dataIndex:a,text:"Scenario ID",editor:"rallytextfield"});var b=this._getFetchFields();this.setLoading("Fetching Test Cases");{Ext.create("Rally.data.wsapi.Store",{model:"TestCase",autoLoad:!0,limit:"Infinity",fetch:b,context:{projectScopeDown:!1,projectScopeUp:!1},listeners:{scope:this,load:function(a,b){this.logger.log("Found "+b.length+" test cases");var c=this._getDuplicatesAndEmpties(b);this.setLoading(!1),this._makeGrid(c)}}})}}},_getDuplicatesAndEmpties:function(a){var b=[],c=this.getSetting("scenario_id_field_name"),d={};return Ext.Array.each(a,function(a){var b=a.get(c)||"None";d[b]||(d[b]=[]),d[b].push(a)}),b=d.None,Ext.Object.each(d,function(a,c){"None"!==a&&c.length>1&&(b=Ext.Array.push(b,c))}),b},_makeGrid:function(a){var b=this,c=this.getSetting("scenario_id_field_name"),d=Ext.create("Rally.data.custom.Store",{data:a,sorters:[{property:c,direction:"DESC"}]});this.down("#grid_box").removeAll(),this.down("#grid_box").add({xtype:"rallygrid",columnCfgs:b.columns,store:d,enableRanking:!1,showRowActionsColumn:!1,pagingToolbarCfg:{store:d}})},_getFetchFields:function(){var a=[];return Ext.Array.each(this.columns,function(b){a.push(b.dataIndex)}),a},getSettingsFields:function(){return[{name:"scenario_id_field_name",xtype:"rallyfieldcombobox",model:"TestCase",fieldLabel:"ID Field Name",readyEvent:"ready"}]},_showExternalSettingsDialog:function(a){var b=this;this.settings_dialog&&this.settings_dialog.destroy(),this.settings_dialog=Ext.create("Rally.ui.dialog.Dialog",{autoShow:!1,draggable:!0,width:400,title:"Settings",buttons:[{text:"OK",handler:function(c){var d={};Ext.Array.each(a,function(a){d[a.name]=c.up("rallydialog").down('[name="'+a.name+'"]').getValue()}),b.settings=d,c.up("rallydialog").destroy(),b._getData()}}],items:[{xtype:"container",html:"&nbsp;",padding:5,margin:5},{xtype:"container",itemId:"field_box",padding:5,margin:5}]}),Ext.Array.each(a,function(a){b.settings_dialog.down("#field_box").add(a)}),this.settings_dialog.show()}});